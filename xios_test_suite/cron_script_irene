#/bin/bash
set -x 
xios_branch=trunk
xios_svn_rep="svn+ssh://forge.ipsl.jussieu.fr/ipsl/forge/projets/ioserver/svn/XIOS"
xios_test_suite_dir="/ccc/scratch/cont003/gen0826/gen0826/XIOS_TEST_SUITE"

#permission for group
CHMOD() { chmod --quiet ug+rwX,o+rX "$@" ;}

mkdir -p $xios_test_suite_dir ; CHMOD $xios_test_suite_dir
mkdir -p $xios_test_suite_dir/$xios_branch ; CHMOD $xios_test_suite_dir/$xios_branch

full_branch_dir=${xios_test_suite_dir}/$xios_branch
full_svn_rep=$xios_svn_rep/$xios_branch

cd $full_branch_dir

if [ ! -f "./last_rev_tested" ]; then
  echo 0 > ./last_rev_tested 
  CHMOD ./last_rev_tested 
fi

last_rev=`cat ./last_rev_tested`
current_rev=`svn info --show-item last-changed-revision $full_svn_rep`

if [ "$current_rev" -gt "$last_rev" ];
then 
    echo $current_rev > last_rev_tested
    CHMOD ./last_rev_tested 
    svn co $full_svn_rep xios_rev_$current_rev
    (cd xios_rev_$current_rev/xios_test_suite && ./launch_all)
    CHMOD -R xios_rev_$current_rev
fi;
